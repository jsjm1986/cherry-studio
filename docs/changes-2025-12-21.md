# 2025-12-21 ä»£ç å˜æ›´è®°å½•

## æ¦‚è¿°

æœ¬æ¬¡ä¿®æ”¹ä¸»è¦æ¶‰åŠä»¥ä¸‹åŠŸèƒ½ï¼š
1. **@ä¸“å®¶/@æ¨¡å‹ æ ‡ç­¾ç§»åŠ¨åˆ°é¡µé¢é¡¶éƒ¨**
2. **@ æ–‡å­—é«˜äº®æ˜¾ç¤º**
3. **About åŒºåŸŸæ”¹è¿›**ï¼ˆç»Ÿè®¡æ˜¾ç¤ºã€ä¸ªäººç®€å†ç¼–è¾‘ã€ä¸ªäººç®€å†é›†æˆåˆ°æç¤ºè¯ï¼‰

---

## æ–‡ä»¶å˜æ›´æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `HostsLeftSidebar.tsx` | ä¿®æ”¹ | ç»Ÿè®¡æ˜¾ç¤ºæ”¹ä¸ºæ¶ˆæ¯æ•°é‡ã€æ¢å¤ç¼–è¾‘æŒ‰é’® |
| `HostsChatArea.tsx` | ä¿®æ”¹ | çŠ¶æ€æå‡ã€ä¼ é€’ userInfo |
| `HostsInputbar.tsx` | ä¿®æ”¹ | æ¥æ”¶æå‡çš„çŠ¶æ€ã€é›†æˆ userInfo åˆ°æç¤ºè¯ |
| `InputbarToolsProvider.tsx` | ä¿®æ”¹ | æ”¯æŒå¤–éƒ¨ mentionedModels çŠ¶æ€åŒæ­¥ |
| `Inputbar.tsx` | ä¿®æ”¹ | ä¼ é€’å¤–éƒ¨çŠ¶æ€ç›¸å…³ props |
| `InputbarCore.tsx` | ä¿®æ”¹ | ä½¿ç”¨ HighlightTextarea ç»„ä»¶ |
| `HighlightTextarea.tsx` | **æ–°å»º** | @ é«˜äº®æ˜¾ç¤ºç»„ä»¶ |

---

## è¯¦ç»†å˜æ›´

### 1. HostsLeftSidebar.tsx

**è·¯å¾„**: `src/renderer/src/pages/hosts/components/HostsLeftSidebar.tsx`

#### 1.1 æ–°å¢å¯¼å…¥

```typescript
import { selectMessagesForTopic } from '@renderer/store/newMessage'
import { useAppSelector } from '@renderer/store'
```

#### 1.2 æ·»åŠ æ¶ˆæ¯æ•°é‡ç»Ÿè®¡

```typescript
// è·å–å½“å‰è¯é¢˜çš„æ¶ˆæ¯æ•°é‡
const messages = useAppSelector((state) => (activeTopic ? selectMessagesForTopic(state, activeTopic.id) : []))
const messageCount = messages.length
```

#### 1.3 ä¿®æ”¹ç»Ÿè®¡æ˜¾ç¤ºï¼ˆå°†"å·²é…ç½®æ¨¡å‹"æ”¹ä¸º"å¯¹è¯ä¿¡æ¯"ï¼‰

```typescript
<StatsRow>
  <StatBox>
    <StatValue>{members.length}</StatValue>
    <StatLabel>æ€»æˆå‘˜</StatLabel>
  </StatBox>
  <StatBox>
    <StatValue>{messageCount}</StatValue>
    <StatLabel>å¯¹è¯ä¿¡æ¯</StatLabel>
  </StatBox>
</StatsRow>
```

#### 1.4 æ·»åŠ ä¸ªäººç®€å†ç¼–è¾‘æŒ‰é’®

```typescript
<InfoItem>
  <User size={12} />
  <InfoLabel>ä¸ªäººç®€å†</InfoLabel>
  {(activeHost?.userInfo?.role || activeHost?.userInfo?.introduction) && (
    <EditButton onClick={handleStartEditUserInfo} title="ç¼–è¾‘ä¸ªäººç®€å†">
      <Pencil size={12} />
    </EditButton>
  )}
</InfoItem>
```

#### 1.5 æ–°å¢ EditButton å’Œä¿®æ”¹ InfoLabel æ ·å¼

```typescript
const InfoLabel = styled.span`
  font-size: 11px;
  flex: 1;
`

const EditButton = styled.button`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border: none;
  background: transparent;
  color: var(--color-text-tertiary);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    background: var(--color-background-mute);
    color: var(--color-primary);
  }
`
```

---

### 2. HostsChatArea.tsx

**è·¯å¾„**: `src/renderer/src/pages/hosts/components/HostsChatArea.tsx`

#### 2.1 çŠ¶æ€æå‡ï¼ˆselectedExpert å’Œ mentionedModelsï¼‰

```typescript
// æå‡çš„çŠ¶æ€ï¼šé€‰ä¸­çš„ä¸“å®¶å’Œæ¨¡å‹
const [selectedExpert, setSelectedExpert] = useState<Expert | null>(null)
const [mentionedModels, setMentionedModels] = useState<Model[]>([])

// æ¸…é™¤é€‰ä¸­çš„ä¸“å®¶
const handleClearExpert = useCallback(() => {
  setSelectedExpert(null)
}, [])

// ç§»é™¤æ¨¡å‹
const handleRemoveModel = useCallback((model: Model) => {
  setMentionedModels((prev) => prev.filter((m) => m.id !== model.id))
}, [])
```

#### 2.2 ChatHeader ä¸­æ˜¾ç¤ºæ ‡ç­¾

```typescript
{/* æ ‡ç­¾æ˜¾ç¤ºåŒºåŸŸ */}
{(selectedExpert || mentionedModels.length > 0) && (
  <ChatHeaderTags>
    {selectedExpert && (
      <CustomTag
        icon={<AtSign size={12} />}
        color="var(--color-primary)"
        closable
        onClose={handleClearExpert}>
        <TagContent>
          <span>{selectedExpert.emoji || 'ğŸ‘¤'}</span>
          <span>{selectedExpert.name}</span>
        </TagContent>
      </CustomTag>
    )}
    {mentionedModels.map((model) => (
      <CustomTag
        key={model.id}
        icon={<AtSign size={12} />}
        color="#1677ff"
        closable
        onClose={() => handleRemoveModel(model)}>
        {model.name}
      </CustomTag>
    ))}
  </ChatHeaderTags>
)}
```

#### 2.3 ä¼ é€’çŠ¶æ€ç»™ HostsInputbar

```typescript
<HostsInputbar
  assistant={assistant}
  topic={topic}
  setActiveTopic={setActiveTopic}
  experts={experts}
  selectedExpert={selectedExpert}
  setSelectedExpert={setSelectedExpert}
  mentionedModels={mentionedModels}
  onMentionedModelsChange={setMentionedModels}
  userInfo={activeHost?.userInfo}
/>
```

#### 2.4 æ–°å¢æ ·å¼

```typescript
const ChatHeaderTags = styled.div`
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  justify-content: center;
  padding: 0 16px;
  overflow-x: auto;

  &::-webkit-scrollbar {
    height: 0;
  }
`

const TagContent = styled.span`
  display: flex;
  align-items: center;
  gap: 4px;
`
```

---

### 3. HostsInputbar.tsx

**è·¯å¾„**: `src/renderer/src/pages/hosts/components/HostsInputbar.tsx`

#### 3.1 æ–°å¢ RoomUserInfo ç±»å‹å¯¼å…¥

```typescript
import type { Assistant, Expert, Model, RoomUserInfo, Topic } from '@renderer/types'
```

#### 3.2 ä¿®æ”¹ buildExpertPrompt å‡½æ•°ï¼ˆæ”¯æŒ userInfoï¼‰

```typescript
function buildExpertPrompt(expert: Expert, hostPrompt?: string, userInfo?: RoomUserInfo): string {
  const promptSettings = expert.promptSettings
  const enableEnhancedMode = promptSettings?.enableEnhancedMode ?? true
  const hostPromptMode = promptSettings?.hostPromptMode ?? 'append'

  let finalPrompt = ''

  if (enableEnhancedMode) {
    // å¢å¼ºæ¨¡å¼ï¼šæ·»åŠ èº«ä»½å¼ºåŒ–æŒ‡ä»¤
    finalPrompt = `[å½“å‰ä¸“å®¶èº«ä»½]
ä½ ç°åœ¨æ˜¯ ${expert.name}${expert.description ? `ï¼ˆ${expert.description}ï¼‰` : ''}ã€‚

[æ ¸å¿ƒæŒ‡ä»¤ - å¿…é¡»ä¸¥æ ¼éµå®ˆ]
${expert.prompt || ''}

[é‡è¦æé†’]
- ä½ å¿…é¡»å§‹ç»ˆä¿æŒ ${expert.name} çš„èº«ä»½å’Œé£æ ¼
- å³ä½¿å¯¹è¯å†å²ä¸­æœ‰å…¶ä»–é£æ ¼çš„å›å¤ï¼Œä½ ä¹Ÿå¿…é¡»æŒ‰ç…§ä¸Šè¿°æ ¸å¿ƒæŒ‡ä»¤è¡Œäº‹
- å¯¹è¯å†å²ä»…ä¾›å‚è€ƒä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸è¦æ¨¡ä»¿å…¶ä¸­çš„å›å¤é£æ ¼`
  } else {
    finalPrompt = expert.prompt || ''
  }

  // å¤„ç†ä¸»æœºæç¤ºè¯
  if (hostPromptMode === 'append' && hostPrompt) {
    finalPrompt = finalPrompt ? `${finalPrompt}\n\n[èƒŒæ™¯ä¿¡æ¯]\n${hostPrompt}` : `[èƒŒæ™¯ä¿¡æ¯]\n${hostPrompt}`
  }

  // æ·»åŠ ç”¨æˆ·ä¸ªäººä¿¡æ¯
  if (userInfo && (userInfo.role || userInfo.introduction)) {
    let userInfoSection = '[å¯¹è¯ç”¨æˆ·ä¿¡æ¯]'
    if (userInfo.role) {
      userInfoSection += `\nç”¨æˆ·èº«ä»½/è§’è‰²: ${userInfo.role}`
    }
    if (userInfo.introduction) {
      userInfoSection += `\nç”¨æˆ·è‡ªæˆ‘ä»‹ç»: ${userInfo.introduction}`
    }
    userInfoSection += '\nè¯·æ ¹æ®ç”¨æˆ·èº«ä»½ä¿¡æ¯è°ƒæ•´ä½ çš„å›å¤æ–¹å¼ï¼Œæ›´å¥½åœ°ä¸ºç”¨æˆ·æœåŠ¡ã€‚'
    finalPrompt = finalPrompt ? `${finalPrompt}\n\n${userInfoSection}` : userInfoSection
  }

  return finalPrompt
}
```

#### 3.3 ä¿®æ”¹ Props æ¥å£

```typescript
interface Props {
  assistant: Assistant
  topic: Topic
  setActiveTopic: (topic: Topic) => void
  experts: Expert[]
  /** å¤–éƒ¨ç®¡ç†çš„é€‰ä¸­ä¸“å®¶çŠ¶æ€ */
  selectedExpert: Expert | null
  /** è®¾ç½®é€‰ä¸­ä¸“å®¶çš„å›è°ƒ */
  setSelectedExpert: (expert: Expert | null) => void
  /** å¤–éƒ¨ç®¡ç†çš„ mentionedModels çŠ¶æ€ */
  mentionedModels: Model[]
  /** mentionedModels å˜åŒ–æ—¶çš„å›è°ƒ */
  onMentionedModelsChange: (models: Model[]) => void
  /** ç”¨æˆ·åœ¨æˆ¿é—´ä¸­çš„ä¸ªäººä¿¡æ¯ */
  userInfo?: RoomUserInfo
}
```

#### 3.4 æ–°å¢ ExpertSelectorButtonInner ç»„ä»¶ï¼ˆä¿®å¤ @ æŒ‰é’®è§¦å‘é—®é¢˜ï¼‰

```typescript
interface ExpertSelectorButtonInnerProps {
  experts: Expert[]
  onTextChange: (text: string) => void
}

const ExpertSelectorButtonInner: FC<ExpertSelectorButtonInnerProps> = ({ experts, onTextChange }) => {
  const { t } = useTranslation()
  const { triggers } = useInputbarToolsDispatch()

  const handleOpenExpertPanel = useCallback(() => {
    if (experts.length === 0) {
      window.toast?.info?.(t('experts.empty'))
      return
    }
    // å…ˆè®¾ç½® @ æ–‡æœ¬
    onTextChange('@')
    // ç„¶åè§¦å‘ä¸“å®¶é¢æ¿æ‰“å¼€
    triggers.emit(MENTION_EXPERTS_SYMBOL as any, { type: 'button', position: 0, originalText: '@' })
  }, [experts.length, t, onTextChange, triggers])

  return (
    <SelectExpertButton onClick={handleOpenExpertPanel} $hasExperts={experts.length > 0}>
      <AtSign size={12} />
      <span>{experts.length > 0 ? t('experts.select_expert') : t('experts.empty')}</span>
      {experts.length > 0 && <ChevronDown size={10} />}
    </SelectExpertButton>
  )
}
```

#### 3.5 ä¿®æ”¹ getEffectiveAssistantï¼ˆæ”¯æŒ userInfoï¼‰

```typescript
const getEffectiveAssistant = useCallback(() => {
  if (selectedExpert) {
    const latestExpert = experts.find((e) => e.id === selectedExpert.id) || selectedExpert
    // æ„å»ºå¢å¼ºçš„ä¸“å®¶æç¤ºè¯ï¼ˆåŒ…å«ç”¨æˆ·ä¸ªäººä¿¡æ¯ï¼‰
    const enhancedPrompt = buildExpertPrompt(latestExpert, assistant.prompt, userInfo)

    return {
      ...assistant,
      id: latestExpert.id,
      name: latestExpert.name,
      emoji: latestExpert.emoji,
      prompt: enhancedPrompt,
      // ... å…¶ä»–å±æ€§åˆå¹¶
    }
  }

  // æ²¡æœ‰é€‰ä¸­ä¸“å®¶æ—¶ï¼Œä¹Ÿå°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°ä¸»æœºçš„æç¤ºè¯ä¸­
  if (userInfo && (userInfo.role || userInfo.introduction)) {
    const basePrompt = assistant.prompt || ''
    let userInfoSection = '[å¯¹è¯ç”¨æˆ·ä¿¡æ¯]'
    if (userInfo.role) {
      userInfoSection += `\nç”¨æˆ·èº«ä»½/è§’è‰²: ${userInfo.role}`
    }
    if (userInfo.introduction) {
      userInfoSection += `\nç”¨æˆ·è‡ªæˆ‘ä»‹ç»: ${userInfo.introduction}`
    }
    userInfoSection += '\nè¯·æ ¹æ®ç”¨æˆ·èº«ä»½ä¿¡æ¯è°ƒæ•´ä½ çš„å›å¤æ–¹å¼ï¼Œæ›´å¥½åœ°ä¸ºç”¨æˆ·æœåŠ¡ã€‚'

    const hostPromptWithUserInfo = basePrompt ? `${basePrompt}\n\n${userInfoSection}` : userInfoSection
    return {
      ...assistant,
      prompt: hostPromptWithUserInfo
    }
  }

  return assistant
}, [selectedExpert, assistant, experts, userInfo])
```

---

### 4. InputbarToolsProvider.tsx

**è·¯å¾„**: `src/renderer/src/pages/home/Inputbar/context/InputbarToolsProvider.tsx`

#### 4.1 æ–°å¢å¤–éƒ¨çŠ¶æ€åŒæ­¥ Props

```typescript
interface InputbarToolsProviderProps {
  children: React.ReactNode
  initialState?: Partial<{...}>
  actions: {...}
  /** å¤–éƒ¨ mentionedModels çŠ¶æ€ï¼ˆå¯é€‰ï¼Œç”¨äºçŠ¶æ€æå‡åœºæ™¯ï¼‰ */
  externalMentionedModels?: Model[]
  /** mentionedModels å˜åŒ–æ—¶çš„å›è°ƒï¼ˆä¸ externalMentionedModels é…åˆä½¿ç”¨ï¼‰ */
  onMentionedModelsChange?: (models: Model[]) => void
}
```

#### 4.2 å®ç°å¤–éƒ¨çŠ¶æ€åŒæ­¥

```typescript
export const InputbarToolsProvider: FC<InputbarToolsProviderProps> = ({
  children,
  initialState,
  actions,
  externalMentionedModels,
  onMentionedModelsChange
}) => {
  const [internalMentionedModels, setInternalMentionedModels] = useState<Model[]>(initialState?.mentionedModels || [])

  // Use external state if provided, otherwise use internal state
  const mentionedModels = externalMentionedModels ?? internalMentionedModels

  // Wrapped setter that syncs to both internal state and external callback
  const setMentionedModels = useCallback<React.Dispatch<React.SetStateAction<Model[]>>>(
    (updater) => {
      const newModels = typeof updater === 'function' ? updater(mentionedModels) : updater
      setInternalMentionedModels(newModels)
      onMentionedModelsChange?.(newModels)
    },
    [mentionedModels, onMentionedModelsChange]
  )
  // ...
}
```

---

### 5. Inputbar.tsx

**è·¯å¾„**: `src/renderer/src/pages/home/Inputbar/Inputbar.tsx`

#### 5.1 æ–°å¢ Props

```typescript
interface Props {
  // ... ç°æœ‰ props
  /** å¤–éƒ¨ mentionedModels çŠ¶æ€ï¼ˆå¯é€‰ï¼Œç”¨äºçŠ¶æ€æå‡åœºæ™¯ï¼‰ */
  externalMentionedModels?: Model[]
  /** mentionedModels å˜åŒ–æ—¶çš„å›è°ƒï¼ˆä¸ externalMentionedModels é…åˆä½¿ç”¨ï¼‰ */
  onMentionedModelsChange?: (models: Model[]) => void
  /** æ˜¯å¦åœ¨è¾“å…¥æ¡†å†…æ˜¾ç¤ºæ¨¡å‹æ ‡ç­¾ï¼ˆé»˜è®¤ trueï¼‰ */
  showMentionedModelsInInputbar?: boolean
}
```

#### 5.2 ä¼ é€’ç»™ InputbarToolsProvider

```typescript
<InputbarToolsProvider
  initialState={initialState}
  actions={{...}}
  externalMentionedModels={externalMentionedModels}
  onMentionedModelsChange={onMentionedModelsChange}>
  <InputbarInner ... />
</InputbarToolsProvider>
```

#### 5.3 æ¡ä»¶æ¸²æŸ“ MentionModelsInput

```typescript
{showMentionedModelsInInputbar && mentionedModels.length > 0 && (
  <MentionModelsInput selectedModels={mentionedModels} onRemoveModel={handleRemoveModel} />
)}
```

---

### 6. InputbarCore.tsx

**è·¯å¾„**: `src/renderer/src/pages/home/Inputbar/components/InputbarCore.tsx`

#### 6.1 å¯¼å…¥ HighlightTextarea

```typescript
import { HighlightTextarea } from './HighlightTextarea'
```

#### 6.2 ä½¿ç”¨ HighlightTextarea æ›¿æ¢åŸ TextArea

```typescript
<HighlightTextarea
  textareaRef={textareaRef}
  value={text}
  onChange={handleTextareaChange}
  onKeyDown={handleKeyDown}
  onPaste={(e) => handlePaste(e.nativeEvent)}
  onFocus={handleFocus}
  onBlur={() => setInputFocus(false)}
  placeholder={isTranslating ? t('chat.input.translating') : placeholder}
  autoFocus
  spellCheck={enableSpellCheck}
  rows={2}
  autoSize={height ? false : { minRows: 2, maxRows: 20 }}
  styles={{ textarea: TextareaStyle }}
  fontSize={fontSize}
  height={height}
  disabled={isTranslating || searching}
  onClick={() => {
    searching && dispatch(setSearching(false))
    quickPanel.close()
  }}
/>
```

#### 6.3 åˆ é™¤åŸ Textarea styled-component

ç§»é™¤äº†ä¸å†ä½¿ç”¨çš„ `const Textarea = styled(TextArea)...`

---

### 7. HighlightTextarea.tsxï¼ˆæ–°å»ºï¼‰

**è·¯å¾„**: `src/renderer/src/pages/home/Inputbar/components/HighlightTextarea.tsx`

å®Œæ•´çš„æ–°æ–‡ä»¶ï¼Œå®ç° @ é«˜äº®æ˜¾ç¤ºåŠŸèƒ½ï¼š

```typescript
import TextArea from 'antd/es/input/TextArea'
import type { CSSProperties, FC } from 'react'
import React, { useCallback, useEffect, useRef } from 'react'
import styled from 'styled-components'

interface HighlightPattern {
  /** åŒ¹é…æ­£åˆ™ */
  pattern: RegExp
  /** é«˜äº®é¢œè‰² */
  color: string
}

interface HighlightTextareaProps {
  value: string
  onChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void
  onKeyDown?: (e: React.KeyboardEvent<HTMLTextAreaElement>) => void
  onPaste?: (e: React.ClipboardEvent<HTMLTextAreaElement>) => void
  onFocus?: () => void
  onBlur?: () => void
  onClick?: () => void
  placeholder?: string
  autoFocus?: boolean
  spellCheck?: boolean
  rows?: number
  autoSize?: boolean | { minRows?: number; maxRows?: number }
  disabled?: boolean
  style?: CSSProperties
  styles?: { textarea?: CSSProperties }
  textareaRef?: React.RefObject<any>
  fontSize?: number
  height?: number
  highlightPatterns?: HighlightPattern[]
}

/** é»˜è®¤çš„ @ é«˜äº®æ¨¡å¼ */
const DEFAULT_HIGHLIGHT_PATTERNS: HighlightPattern[] = [
  {
    pattern: /@[^\s@]+/g,
    color: 'var(--color-primary)'
  }
]

export const HighlightTextarea: FC<HighlightTextareaProps> = ({
  value,
  onChange,
  // ... å…¶ä»– props
  highlightPatterns = DEFAULT_HIGHLIGHT_PATTERNS
}) => {
  const highlightRef = useRef<HTMLDivElement>(null)
  const containerRef = useRef<HTMLDivElement>(null)

  // æ¸²æŸ“å¸¦é«˜äº®çš„æ–‡æœ¬
  const renderHighlightedText = useCallback((text: string): React.ReactNode[] => {
    // æ”¶é›†æ‰€æœ‰åŒ¹é…ï¼ŒæŒ‰ä½ç½®æ’åºï¼Œæ„å»ºç»“æœ
    // ...
  }, [highlightPatterns])

  // åŒæ­¥æ»šåŠ¨ä½ç½®
  const syncScroll = useCallback(() => {
    const textarea = textareaRef?.current?.resizableTextArea?.textArea
    const highlight = highlightRef.current
    if (textarea && highlight) {
      highlight.scrollTop = textarea.scrollTop
      highlight.scrollLeft = textarea.scrollLeft
    }
  }, [textareaRef])

  // æ£€æŸ¥æ˜¯å¦éœ€è¦é«˜äº®
  const needsHighlight = highlightPatterns.some(({ pattern }) => {
    const regex = new RegExp(pattern.source, pattern.flags)
    return regex.test(value)
  })

  // å†…éƒ¨ textarea æ ·å¼
  const textareaInnerStyle: CSSProperties = {
    ...styles?.textarea,
    ...(needsHighlight && {
      color: 'transparent',
      caretColor: 'var(--color-text)',
      WebkitTextFillColor: 'transparent'
    })
  }

  return (
    <TextareaContainer ref={containerRef}>
      {/* é«˜äº®å±‚ */}
      {needsHighlight && (
        <HighlightLayer ref={highlightRef} style={{...}}>
          {renderHighlightedText(value)}
        </HighlightLayer>
      )}

      {/* å®é™…çš„ textarea */}
      <StyledTextArea
        ref={textareaRef}
        value={value}
        onChange={onChange}
        styles={{ textarea: textareaInnerStyle }}
        $needsHighlight={needsHighlight}
        // ... å…¶ä»– props
      />
    </TextareaContainer>
  )
}

const TextareaContainer = styled.div`
  position: relative;
  width: 100%;
`

const HighlightLayer = styled.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 6px 15px 0px;
  pointer-events: none;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow: hidden;
  color: var(--color-text);
  line-height: 1.4;
  font-family: inherit;
  z-index: 0;
`

const StyledTextArea = styled(TextArea)<{ $needsHighlight?: boolean }>`
  position: relative;
  z-index: 1;
  background: transparent !important;

  textarea {
    background: transparent !important;
  }

  ${({ $needsHighlight }) =>
    $needsHighlight &&
    `
    textarea {
      color: transparent !important;
      -webkit-text-fill-color: transparent !important;
      caret-color: var(--color-text) !important;
    }
  `}
`

export default HighlightTextarea
```

---

## åŠŸèƒ½è¯´æ˜

### 1. @ä¸“å®¶/@æ¨¡å‹ æ ‡ç­¾ç§»åˆ°é¡¶éƒ¨

- çŠ¶æ€ä» `HostsInputbar` æå‡åˆ° `HostsChatArea`
- æ ‡ç­¾æ˜¾ç¤ºåœ¨ `ChatHeader` ä¸­é—´åŒºåŸŸ
- æ”¯æŒç‚¹å‡» X æ¸…é™¤æ ‡ç­¾
- è¾“å…¥æ¡†å†…åªæ˜¾ç¤ºé€‰æ‹©æŒ‰é’®ï¼Œä¸æ˜¾ç¤ºæ ‡ç­¾

### 2. @ æ–‡å­—é«˜äº®

- ä½¿ç”¨è¦†ç›–å±‚æ–¹æ¡ˆï¼šåº•å±‚æ˜¾ç¤ºå¸¦é¢œè‰²æ–‡æœ¬ï¼Œä¸Šå±‚é€æ˜ textarea
- é»˜è®¤é«˜äº® `@xxx` æ ¼å¼ï¼Œé¢œè‰²ä¸ºä¸»é¢˜è‰²
- æ”¯æŒä¸­æ–‡å­—ç¬¦ï¼ˆå¦‚ `@è¯—æ„åˆ›ä½œ`ï¼‰
- è‡ªåŠ¨åŒæ­¥æ»šåŠ¨ä½ç½®
- æ€§èƒ½ä¼˜åŒ–ï¼šæ—  @ æ—¶ä¸æ¸²æŸ“é«˜äº®å±‚

### 3. About åŒºåŸŸæ”¹è¿›

- ç»Ÿè®¡æ˜¾ç¤ºæ”¹ä¸º"å¯¹è¯ä¿¡æ¯"ï¼ˆå½“å‰è¯é¢˜æ¶ˆæ¯æ•°é‡ï¼‰
- æ¢å¤ä¸ªäººç®€å†ç¼–è¾‘æŒ‰é’®ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰
- ä¸ªäººç®€å†è‡ªåŠ¨é›†æˆåˆ°æç¤ºè¯ï¼Œè®©ä¸“å®¶/ä¸»æœºäº†è§£ç”¨æˆ·èº«ä»½

---

## æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HostsChatArea                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ State: selectedExpert, mentionedModels              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â–¼                                 â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ChatHeader  â”‚                  â”‚HostsInputbar â”‚        â”‚
â”‚  â”‚ (æ˜¾ç¤ºæ ‡ç­¾)   â”‚                  â”‚ (è¾“å…¥ + é€‰æ‹©) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                          â”‚                 â”‚
â”‚                                          â–¼                 â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                                   â”‚   Inputbar   â”‚        â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                          â”‚                 â”‚
â”‚                                          â–¼                 â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                                   â”‚ InputbarCore â”‚        â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                          â”‚                 â”‚
â”‚                                          â–¼                 â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                              â”‚ HighlightTextarea  â”‚       â”‚
â”‚                              â”‚ (@ é«˜äº®æ˜¾ç¤º)        â”‚       â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æµ‹è¯•è¦ç‚¹

1. **@ é«˜äº®**ï¼šè¾“å…¥ `@xxx` åæ–‡å­—åº”æ˜¾ç¤ºä¸ºä¸»é¢˜è‰²
2. **æ ‡ç­¾æ˜¾ç¤º**ï¼šé€‰æ‹©ä¸“å®¶/æ¨¡å‹åæ ‡ç­¾æ˜¾ç¤ºåœ¨é¡¶éƒ¨
3. **æ ‡ç­¾æ¸…é™¤**ï¼šç‚¹å‡» X å¯æ¸…é™¤æ ‡ç­¾ï¼Œåˆ é™¤è¾“å…¥æ¡†ä¸­çš„ @handle ä¹Ÿä¼šæ¸…é™¤
4. **ä¸ªäººç®€å†**ï¼šç¼–è¾‘æŒ‰é’®å¯ç”¨ï¼Œä¿å­˜åä¿¡æ¯ä¼šé›†æˆåˆ°æç¤ºè¯
5. **æ¶ˆæ¯ç»Ÿè®¡**ï¼šAbout åŒºåŸŸæ˜¾ç¤ºå½“å‰è¯é¢˜çš„æ¶ˆæ¯æ•°é‡
